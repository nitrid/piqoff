"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[9902],{59902:(t,e,n)=>{n.r(e),n.d(e,{default:()=>M});var a=n(4942),r=n(15861),s=n(15671),i=n(43144),o=n(97326),c=n(60136),l=n(82963),u=n(61120),d=n(64687),E=n.n(d),h=n(67294),m=n(73364),p=n(4598),T=n(30381),b=n.n(T),f=n(42866),D=n.n(f),O=n(53221),C=n.n(O),I=n(25552),g=n.n(I),N=(n(65580),n(91686),n(30886)),v=n(99846),w=(n(5083),n(99077)),A=n(55585),R=(n(417),n(32175)),_=n(18405),x=n(73682),S=n(90428),P=(n(57941),n(60547));function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}n(17276),n(51166);var M=function(t){(0,c.Z)(M,t);var e,n,a,d,T,f,O,U=(f=M,O=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,u.Z)(f);if(O){var n=(0,u.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function M(t){var e;return(0,s.Z)(this,M),(e=U.call(this,t)).core=m.Z.instance.core,e.prmObj=e.param.filter({TYPE:1,USERS:e.user.CODE}),e.acsobj=e.access.filter({TYPE:1,USERS:e.user.CODE}),e.docObj=new p.Ch,e._btnGetClick=e._btnGetClick.bind((0,o.Z)(e)),e._btnSave=e._btnSave.bind((0,o.Z)(e)),e.txtRef=Math.floor(Date.now()/1e3),e.tabIndex=t.data.tabkey,e}return(0,i.Z)(M,[{key:"componentDidMount",value:function(){var t=this;setTimeout((0,r.Z)(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.Init();case 1:case"end":return e.stop()}}),e)}))),1e3)}},{key:"Init",value:(T=(0,r.Z)(E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.docObj.clearAll(),this.txtRef=Math.floor(Date.now()/1e3),this.dtFirstDate.value=b()(new Date).format("YYYY-MM-DD"),this.dtLastDate.value=b()(new Date).format("YYYY-MM-DD");case 4:case"end":return t.stop()}}),t,this)}))),function(){return T.apply(this,arguments)})},{key:"_btnGetClick",value:(d=(0,r.Z)(E().mark((function t(){var e;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={source:{select:{query:"SELECT REF,REF_NO,CONVERT(NVARCHAR,DOC_DATE,104) AS DOC_DATE,SUM(QUANTITY) AS QUANTITY FROM ITEM_COUNT_VW_01  WHERE DEPOT = @DEPOT AND DOC_DATE >=@FIRSTDATE AND DOC_DATE <= @LASTDATE  GROUP BY REF,REF_NO,DOC_DATE",param:["DEPOT:string|50","FIRSTDATE:date","LASTDATE:date"],value:[this.cmbDepot.value,this.dtFirstDate.value,this.dtLastDate.value]},sql:this.core.sql}},t.next=3,this.grdCountDocument.dataRefresh(e);case 3:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"_btnSave",value:(a=(0,r.Z)(E().mark((function t(){var e,n,a,r,s,i;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=y({},this.docObj.empty)).TYPE=1,e.DOC_TYPE=0,e.REBATE=0,e.REF=Math.floor(Date.now()/1e3),e.REF_NO=1,e.OUTPUT=this.cmbDepot.value,e.INPUT=this.cmbDepot.value,e.DOC_DATE=b()(new Date).format("YYYY-MM-DD"),this.docObj.addEmpty(e),n=0;case 10:if(!(n<this.grdCountItems.data.datatable.length)){t.next=48;break}if(!(this.grdCountItems.data.datatable[n].QUANTITY>this.grdCountItems.data.datatable[n].DEPOT_QUANTITY)){t.next=29;break}return(a=y({},this.docObj.docItems.empty)).DOC_GUID=this.docObj.dt()[0].GUID,a.TYPE=0,a.DOC_TYPE=0,a.LINE_NO=this.docObj.docItems.dt().length,a.REF=this.docObj.dt()[0].REF,a.REF_NO=this.docObj.dt()[0].REF_NO,a.INPUT=this.docObj.dt()[0].INPUT,a.OUTPUT=this.docObj.dt()[0].OUTPUT,a.DOC_DATE=this.docObj.dt()[0].DOC_DATE,a.ITEM=this.grdCountItems.data.datatable[n].ITEM,a.ITEM_NAME=this.grdCountItems.data.datatable[n].ITEM_NAME,a.QUANTITY=this.grdCountItems.data.datatable[n].QUANTITY-this.grdCountItems.data.datatable[n].DEPOT_QUANTITY,t.next=27,this.docObj.docItems.addEmpty(a);case 27:t.next=45;break;case 29:if(!(this.grdCountItems.data.datatable[n].QUANTITY<this.grdCountItems.data.datatable[n].DEPOT_QUANTITY)){t.next=45;break}return(r=y({},this.docObj.docItems.empty)).DOC_GUID=this.docObj.dt()[0].GUID,r.TYPE=1,r.DOC_TYPE=0,r.LINE_NO=this.docObj.docItems.dt().length,r.REF=this.docObj.dt()[0].REF,r.REF_NO=this.docObj.dt()[0].REF_NO,r.INPUT=this.docObj.dt()[0].INPUT,r.OUTPUT=this.docObj.dt()[0].OUTPUT,r.DOC_DATE=this.docObj.dt()[0].DOC_DATE,r.ITEM=this.grdCountItems.data.datatable[n].ITEM,r.ITEM_NAME=this.grdCountItems.data.datatable[n].ITEM_NAME,r.QUANTITY=this.grdCountItems.data.datatable[n].DEPOT_QUANTITY-this.grdCountItems.data.datatable[n].QUANTITY,t.next=45,this.docObj.docItems.addEmpty(r);case 45:n++,t.next=10;break;case 48:if(!(this.docObj.docItems.dt().length>0)){t.next=64;break}return s={id:"msgSaveResult",showTitle:!0,title:this.t("msgSave.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgSave.btn01"),location:"after"}]},t.next=52,this.docObj.save();case 52:if(t.t0=t.sent,0!=t.t0){t.next=59;break}return s.content=h.createElement("div",{style:{textAlign:"center",fontSize:"20px",color:"green"}},this.docObj.dt()[0].REF+this.t("msgSaveResult.msgSuccess")),t.next=57,(0,P.W)(s);case 57:t.next=62;break;case 59:return s.content=h.createElement("div",{style:{textAlign:"center",fontSize:"20px",color:"red"}},this.t("msgSaveResult.msgFailed")),t.next=62,(0,P.W)(s);case 62:t.next=68;break;case 64:return(i={id:"msgNotItems",showTitle:!0,title:this.t("msgNotItems.title"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:this.t("msgNotItems.btn01"),location:"after"}]}).content=h.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},this.t("msgNotItems.msg")),t.next=68,(0,P.W)(i);case 68:this.popCount.hide(),this.docObj.clearAll();case 70:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"_toGroupByCustomer",value:(n=(0,r.Z)(E().mark((function t(e,n){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.reduce((function(t,e){var a=e[n];return t[a]||(t[a]=[]),t[a].push(e),t}),{}));case 1:case"end":return t.stop()}}),t)}))),function(t,e){return n.apply(this,arguments)})},{key:"calculateCountItems",value:(e=(0,r.Z)(E().mark((function t(){var e,n,a,r;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e="",n=0;n<this.grdCountDocument.getSelectedData().length;n++)""==e?e="'"+this.grdCountDocument.getSelectedData()[n].REF+this.grdCountDocument.getSelectedData()[n].REF_NO+"'":e+=",'"+this.grdCountDocument.getSelectedData()[n].REF+this.grdCountDocument.getSelectedData()[n].REF_NO+"'";if(0!=this.chkNotCountItems.value){t.next=8;break}return a={source:{select:{query:"SELECT ITEM,ITEM_CODE,ITEM_NAME,SUM(QUANTITY) AS QUANTITY,DEPOT,  [dbo].[FN_DEPOT_QUANTITY](ITEM,DEPOT,GETDATE()) AS DEPOT_QUANTITY FROM ITEM_COUNT_VW_01  WHERE (REF+CONVERT(NVARCHAR,REF_NO)) IN("+e+")  GROUP BY ITEM,ITEM_CODE,ITEM_NAME,DEPOT"},sql:this.core.sql}},t.next=6,this.grdCountItems.dataRefresh(a);case 6:t.next=12;break;case 8:if(1!=this.chkNotCountItems.value){t.next=12;break}return r={source:{select:{query:"SELECT GUID AS ITEM, [dbo].[FN_DEPOT_QUANTITY](GUID,@DEPOT,GETDATE()) AS DEPOT_QUANTITY, NAME AS ITEM_NAME, CODE AS ITEM_CODE, ISNULL((SELECT SUM(QUANTITY) FROM ITEM_COUNT WHERE ITEM_COUNT.ITEM = ITEMS.GUID AND (REF+CONVERT(NVARCHAR,REF_NO)) IN("+e+")),0) AS QUANTITY, @DEPOT AS DEPOT FROM  ITEMS ",param:["DEPOT:string|50"],value:[this.cmbDepot.value]},sql:this.core.sql}},t.next=12,this.grdCountItems.dataRefresh(r);case 12:this.popCount.show();case 13:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"render",value:function(){var t,e=this;return h.createElement("div",null,h.createElement(D(),null,h.createElement("div",{className:"row px-2 pt-2"},h.createElement("div",{className:"col-12"},h.createElement(C(),null,h.createElement(I.Item,{location:"after",locateInMenu:"auto",widget:"dxButton",options:{type:"default",icon:"clear",onClick:(t=(0,r.Z)(E().mark((function t(){var n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={id:"msgClose",showTitle:!0,title:e.lang.t("msgWarning"),showCloseButton:!0,width:"500px",height:"200px",button:[{id:"btn01",caption:e.lang.t("btnYes"),location:"before"},{id:"btn02",caption:e.lang.t("btnNo"),location:"after"}],content:h.createElement("div",{style:{textAlign:"center",fontSize:"20px"}},e.lang.t("msgClose"))},t.next=3,(0,P.W)(n);case 3:"btn01"==t.sent&&m.Z.instance.panel.closePage();case 5:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}})))),h.createElement("div",{className:"row px-2 pt-2"},h.createElement("div",{className:"col-12"},h.createElement(g(),{colCount:3,id:"frmCriter"},h.createElement(I.Item,{colSpan:2},h.createElement(I.Label,{text:this.t("cmbDepot"),alignment:"right"}),h.createElement(w.ZP,{simple:!0,parent:this,id:"cmbDepot",displayExpr:"NAME",valueExpr:"GUID",value:"",searchEnabled:!0,notRefresh:!0,onValueChanged:(0,r.Z)(E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this),data:{source:{select:{query:"SELECT * FROM DEPOT_VW_01"},sql:this.core.sql}},param:this.param.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"cmbDepot",USERS:this.user.CODE})},h.createElement(v.cX,{validationGroup:"frmValidCount"+this.tabIndex},h.createElement(v.n2,{message:this.t("validDepot")})))),h.createElement(I.EmptyItem,null),h.createElement(I.Item,null,h.createElement(I.Label,{text:this.t("dtFirstDate"),alignment:"right"}),h.createElement(S.ZP,{simple:!0,parent:this,id:"dtFirstDate",onValueChanged:(0,r.Z)(E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this)})),h.createElement(I.Item,null,h.createElement(I.Label,{text:this.t("dtLastDate"),alignment:"right"}),h.createElement(S.ZP,{simple:!0,parent:this,id:"dtLastDate",onValueChanged:(0,r.Z)(E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))).bind(this)})),h.createElement(I.Item,{location:"right"},h.createElement(A.ZP,{id:"chkNotCountItems",parent:this,defaultValue:!1,param:this.param.filter({ELEMENT:"chkNotCountItems",USERS:this.user.CODE}),access:this.access.filter({ELEMENT:"chkNotCountItems",USERS:this.user.CODE})}),h.createElement(I.Label,{text:this.t("chkNotCountItems"),alignment:"right"}))))),h.createElement("div",{className:"row px-2 pt-2"},h.createElement("div",{className:"col-3"},h.createElement(x.Z,{text:this.t("btnGet"),type:"success",width:"100%",onClick:this._btnGetClick,validationGroup:"frmValidCount"+this.tabIndex})),h.createElement("div",{className:"col-3"}),h.createElement("div",{className:"col-3"}),h.createElement("div",{className:"col-3"},h.createElement(x.Z,{text:this.t("btnAddCount"),type:"default",width:"100%",onClick:function(){e.calculateCountItems()}}))),h.createElement("div",{className:"row px-2 pt-2"},h.createElement("div",{className:"col-12"},h.createElement(_.ZP,{id:"grdCountDocument",parent:this,selection:{mode:"multiple"},height:"100%",width:"100%",showBorders:!0,filterRow:{visible:!0},headerFilter:{visible:!0},columnAutoWidth:!0,allowColumnReordering:!0,allowColumnResizing:!0,onRowDblClick:function(){var t=(0,r.Z)(E().mark((function t(e){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m.Z.instance.menuClick({id:"stk_02_001",text:"SayÄ±m",path:"items/documents/itemCount.js",pagePrm:{REF:e.data.REF,REF_NO:e.data.REF_NO}});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},h.createElement(_.Po,{defaultPageSize:15}),h.createElement(_.uE,{visible:!0,allowedPageSizes:[5,10,50],showPageSizeSelector:!0}),h.createElement(_.sg,{dataField:"REF",caption:this.t("grdCountDocument.clmRef"),visible:!0}),h.createElement(_.sg,{dataField:"REF_NO",caption:this.t("grdCountDocument.clmRefNo"),visible:!0}),h.createElement(_.sg,{dataField:"DOC_DATE",caption:this.t("grdCountDocument.clmDate"),visible:!0}),h.createElement(_.sg,{dataField:"QUANTITY",caption:this.t("grdCountDocument.clmQuantity"),visible:!0})))),h.createElement("div",null,h.createElement(R.ZP,{parent:this,id:"popCount",visible:!1,showCloseButton:!0,showTitle:!0,title:this.t("popCount.title"),container:"#root",width:"800",height:"800",position:{of:"#root"}},h.createElement(_.ZP,{parent:this,id:"grdCountItems",showBorders:!0,columnsAutoWidth:!0,allowColumnReordering:!0,allowColumnResizing:!0,headerFilter:{visible:!0},height:"80%",width:"100%",dbApply:!1},h.createElement(_.Po,{defaultPageSize:12}),h.createElement(_.uE,{visible:!0,allowedPageSizes:[5,10,50],showPageSizeSelector:!0}),h.createElement(_.m_,{editOnKeyPress:!0,enterKeyAction:"moveFocus",enterKeyDirection:"column"}),h.createElement(_.LO,{mode:"cell",allowUpdating:!1,allowDeleting:!1}),h.createElement(_.sg,{dataField:"ITEM_CODE",caption:this.t("grdCountItems.clmCode"),width:150,headerFilter:{visible:!0}}),h.createElement(_.sg,{dataField:"ITEM_NAME",caption:this.t("grdCountItems.clmName"),width:350,headerFilter:{visible:!0}}),h.createElement(_.sg,{dataField:"QUANTITY",caption:this.t("grdCountItems.clmQuantity"),width:150,headerFilter:{visible:!0}})),h.createElement("div",{className:"row px-2 pt-2"},h.createElement(g(),{colCount:3,height:"fit-content"},h.createElement(I.Item,{location:"after"},h.createElement(N.Button,{text:this.t("btnSuccess"),width:200,type:"success",onClick:function(){var t=(0,r.Z)(E().mark((function t(n){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._btnSave();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}))))))))}}]),M}(h.PureComponent)}}]);